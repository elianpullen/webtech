{% extends 'base.html' %}
{% block content %}
<div class="container">
    <h1>Edit Workout</h1>
    <form method="POST">
        <div class="form-group">
            <label for="name">Workout Name</label>
            <input type="text" class="form-control" id="name" name="name" value="{{ workout.name }}" required>
        </div>
        <div class="form-group">
            <label for="date">Date</label>
            <input type="date" class="form-control" id="date" name="date" value="{{ workout.date }}">
        </div>
        <div class="form-group">
            <label for="note">Notes</label>
            <textarea class="form-control" id="note" name="note" rows="3">{{ workout.note }}</textarea>
        </div>
        <h3>Select Exercises</h3>
        <div class="row">
            {% for exercise in exercises %}
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-body">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="exercise_{{ exercise.id }}"
                                name="exercise_{{ exercise.id }}" {% if exercise.id in workout_exercises %} checked {%
                                endif %}>
                            <label class="form-check-label" for="exercise_{{ exercise.id }}">
                                <h5>{{ exercise.name }}</h5>
                            </label>
                        </div>

                        <div class="exercise-details mt-3" id="details_{{ exercise.id }}">
                            {% set total_sets = workout_sets[exercise.id]|length if exercise.id in workout_sets else 0
                            %}
                            {% set max_sets = 4 %}

                            {% for i in range(1, max_sets + 1) %}
                            {% set existing_set = (workout_sets[exercise.id][i-1] if i <= total_sets else None) %} <div
                                class="border rounded p-3 mb-3 bg-light">
                                <div class="form-group">
                                    <label for="set_{{ exercise.id }}_{{ i }}_reps">Set {{ i }} - Reps</label>
                                    <input type="number" class="form-control" id="set_{{ exercise.id }}_{{ i }}_reps"
                                        name="set_{{ exercise.id }}_{{ i }}_reps"
                                        value="{{ existing_set.reps if existing_set else '' }}">
                                </div>

                                <div class="form-group">
                                    <label for="set_{{ exercise.id }}_{{ i }}_weight">Set {{ i }} - Weight (kg)</label>
                                    <input type="number" class="form-control" id="set_{{ exercise.id }}_{{ i }}_weight"
                                        name="set_{{ exercise.id }}_{{ i }}_weight"
                                        value="{{ existing_set.weight if existing_set else '' }}">
                                </div>

                                <div class="form-group mb-0">
                                    <label for="set_{{ exercise.id }}_{{ i }}_duration">Set {{ i }} - Duration
                                        (seconds)</label>
                                    <input type="number" class="form-control"
                                        id="set_{{ exercise.id }}_{{ i }}_duration"
                                        name="set_{{ exercise.id }}_{{ i }}_duration"
                                        value="{{ existing_set.duration if existing_set else '' }}">
                                </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
</div>

<button type="submit" class="btn btn-primary mt-3">Update Workout</button>
<a href="{{ url_for('main.workouts') }}" class="btn btn-secondary mt-3 ml-2">Cancel</a>
</form>
</div>

<script>
    // Toggle exercise details visibility based on checkbox
    document.addEventListener('DOMContentLoaded', function () {
        const checkboxes = document.querySelectorAll('input[type="checkbox"][id^="exercise_"]');

        checkboxes.forEach(function (checkbox) {
            const id = checkbox.id.split('_')[1];
            const details = document.getElementById('details_' + id);

            const toggleDetails = () => {
                details.style.display = checkbox.checked ? 'block' : 'none';
            };

            toggleDetails(); // Initial state
            checkbox.addEventListener('change', toggleDetails);
        });
    });
</script>
{% endblock %}